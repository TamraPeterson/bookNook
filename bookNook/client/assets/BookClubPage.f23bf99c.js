import{u as P,r as R,z as V,c as r,a as k,b as i,d as l,e as t,t as m,m as p,F as _,D as x,v as A,x as F,g as B,w as I,p as O,q as L}from"./vendor.3dc113be.js";import{a as b,l as d,A as a,_ as N,P as v,c as M}from"./index.1e438dfb.js";class T{async getCommentsByBook(s){const o=await b.get("api/comments?clubBookId="+s);d.log("comments",o.data),a.comments=o.data}async newComment(s){const o=await b.post("api/comments",s);d.log("comment created",o.data),a.comments.unshift(o.data)}async deleteComment(s){const o=a.comments.find(e=>e.id==s);d.log("this be  id",s),await b.delete("api/comments/"+s),a.comments=a.comments.filter(e=>e!=o)}}const g=new T;class E{async createMembership(s,o){const e=await b.post("api/clubs/"+o+"/memberships",s);d.log("creating membership",e.data),e.data.account.memberId=e.data.id,a.memberships.push(e.data.account)}async deleteMembership(s,o){const e=a.memberships.find(h=>h.id==s),f=await b.delete("api/clubs/"+o+"/memberships/"+e.memberId);d.log("deleting membership",f.data),a.memberships=a.memberships.filter(h=>h.memberId!==e.memberId)}}const S=new E;const q={setup(){const n=P(),s=R({editable:{}});return V(async()=>{var o;try{if(n.name=="BookClubPage"){debugger;await M.getClubById((o=n.params)==null?void 0:o.id),d.log(a.activeClub,"active club"),await M.getMemberships(n.params.id),await g.getCommentsByBook(a.activeClub.clubBook.id)}}catch(e){d.error(e),v.toast(e.message,"error")}}),{activeClub:r(()=>a.activeClub),activeBook:r(()=>{var o;return(o=a.activeBook.data)==null?void 0:o.clubBook}),comments:r(()=>a.comments),clubBooks:r(()=>a.clubBooks),memberships:r(()=>a.memberships),account:r(()=>a.account),state:s,isMember:r(()=>a.memberships.find(o=>o.id==a.account.id)),createComment(){let o={creatorId:a.account.id,body:s.editable.body,clubBookId:a.activeClub.clubBook.id};g.newComment(o)},async deleteComment(o){await v.confirm("Are you sure?")&&(d.log("comment id",o),await g.deleteComment(o))},async createMembership(){let o={accountId:a.account.id,clubId:n.params.id};await S.createMembership(o,n.params.id)},async deleteMembership(){try{await S.deleteMembership(a.account.id,n.params.id)}catch(o){d.error(o),v.toast(o.message,"error")}}}}},u=n=>(O("data-v-27821dad"),n=n(),L(),n),z={class:"container-fluid bg-image3"},J=u(()=>t("b",{title:"View Club Books",class:"projects-btn btn bg-club4 text-white rounded-pill shadow d-flex align-items-center justify-content-center","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvas"},[t("i",{class:"mdi mdi-book"})],-1)),U=u(()=>t("b",{title:"Add Book",class:"join-btn btn bg-club4 text-white rounded-pill shadow d-flex align-items-center justify-content-center","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight"},[t("i",{class:"mdi mdi-plus"})],-1)),G={class:"row justify-content-around"},H={class:"p-4 flex-grow col-md-9 rounded shadow bg-club2 m-3 border justify-content-around align-items-center pt-3 text-light"},K={class:"row"},Q={class:"col-md-6 p-3"},W={class:"title-text text-center text-light"},X={key:0,class:"col-md-6 mt-4 text-center"},Y=u(()=>t("h4",null,"Book we're reading:",-1)),Z={class:"row mt-3 justify-content-center"},$={class:"col-md-8"},ee={class:"col-md-9 m-3 p-3 shadow bg-club3 text-light border banner d-flex"},te=u(()=>t("h5",null,"Club Members",-1)),oe=["src","title"],se={class:"col-md-9 m-3 p-3 rounded d-flex justify-content-around rounded"},ae={class:"row container-fluid bg-club2 justify-content-center rounded p-3"},ce={key:0,class:"col-md-6 bg-club3 rounded px-4 py-2 m-3 shadow"},ne={class:"mb-3"},ie=u(()=>t("label",{for:"exampleFormControlTextarea1",class:"form-label"},null,-1)),le={class:"col-md-2"},de=["src"],re={class:"ms-md-4"},me={class:"col-md-9 p-3"},be={class:"col-1"},ue=["onClick"];function he(n,s,o,e,f,h){var C,w;const j=k("OffCanvas"),D=k("RightOffCanvas");return i(),l(_,null,[t("div",z,[J,U,t("div",G,[t("div",H,[t("div",K,[t("div",Q,[t("h1",W,m(e.activeClub.name),1),t("h5",null,m(e.activeClub.description),1)]),e.activeClub.activeBookId?(i(),l("div",X,[Y,t("h3",null,m((C=e.activeClub.clubBook)==null?void 0:C.title),1),t("h6",null," Start Date: "+m(new Date((w=e.activeClub.clubBook)==null?void 0:w.startDate).toLocaleDateString()),1)])):p("",!0)]),t("div",Z,[t("div",$,[e.isMember?(i(),l("button",{key:1,onClick:s[1]||(s[1]=c=>e.deleteMembership()),class:"btn bg-blue shadow rounded text-light"}," Leave this club ")):(i(),l("button",{key:0,onClick:s[0]||(s[0]=c=>e.createMembership()),class:"btn bg-blue shadow rounded text-light"}," Join this Club "))])])]),t("div",ee,[te,(i(!0),l(_,null,x(e.memberships,c=>(i(),l("div",{key:c.accountId},[t("img",{class:"img-fluid comment-photo m-2",src:c.picture,title:c.name,alt:""},null,8,oe)]))),128))]),t("div",se,[t("div",ae,[e.isMember?(i(),l("div",ce,[t("div",ne,[ie,A(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=c=>e.state.editable.body=c),class:"form-control",id:"exampleFormControlTextarea1",rows:"2"},null,512),[[F,e.state.editable.body]])]),t("button",{class:"btn bg-club shadow comment-button m-1",onClick:s[3]||(s[3]=(...c)=>e.createComment&&e.createComment(...c))}," Comment ")])):p("",!0),(i(!0),l(_,null,x(e.comments,c=>{var y;return i(),l("div",{class:"row bg-club3 rounded border p-2 m-2",key:c.id},[t("div",le,[t("img",{class:"comment-photo m-2",src:c.creator.picture,title:"",alt:""},null,8,de),t("p",re,m(c.creator.name),1)]),t("div",me,m(c.body),1),t("div",be,[t("h3",null,[c.creator.id==((y=e.account)==null?void 0:y.id)?(i(),l("i",{key:0,class:"mdi mdi-alpha-x-circle-outline p-0 m-3 selectable",onClick:pe=>e.deleteComment(c.id)},null,8,ue)):p("",!0)])])])}),128))])])]),B(j,null,{"offcanvas-header":I(()=>[]),"offcanvas-body":I(()=>[]),_:1})]),B(D)],64)}var ge=N(q,[["render",he],["__scopeId","data-v-27821dad"]]);export{ge as default};
